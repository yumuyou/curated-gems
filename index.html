<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>沐沐的精选内容</title>
    <link rel="stylesheet" href="./styles.css" />
</head>

<body>
    <header class="container">
        <div class="header-main">
            <div class="logo-area">
                <h1 data-zh="精选内容聚合" data-en="Curated Content Hub">精选内容聚合</h1>
                <p class="subtitle" data-zh="发现优质文章、播客和资源" data-en="Discover quality articles, podcasts and resources">发现优质文章、播客和资源</p>
            </div>
            <div class="header-controls">
                <div class="control-item">
                    <button id="lang-toggle" class="control-button lang-toggle" title="切换语言 / Switch Language">
                        <span class="current-lang" data-zh="中" data-en="EN">中</span>
                    </button>
                </div>
                <div class="control-item version-selector">
                    <div class="version-tabs">
                        <button class="version-tab" data-version="1" data-zh="基础版" data-en="Basic">基础版</button>
                        <button class="version-tab" data-version="2" data-zh="搜索版" data-en="Search">搜索版</button>
                        <button class="version-tab" data-version="3" data-zh="筛选版" data-en="Filter">筛选版</button>
                        <button class="version-tab" data-version="4" data-zh="动态版" data-en="Dynamic">动态版</button>
                    </div>
                    <small id="hint" class="version-hint"></small>
                </div>
            </div>
        </div>
    </header>
    <main class="container">
        <div id="controls"></div>
        <div id="list" class="grid"></div>
        <p id="empty" class="hidden" data-zh="加载中…" data-en="Loading...">加载中…</p>
    </main>
    <script>
        // Language management
        let currentLang = 'zh';
        
        function updateLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';
            
            // Update all elements with data-zh and data-en attributes
            document.querySelectorAll('[data-zh][data-en]').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });
            
            // Update option texts
            document.querySelectorAll('option[data-zh][data-en]').forEach(option => {
                option.textContent = option.getAttribute(`data-${lang}`);
            });
            
            // Update hint text
            const currentVer = new URLSearchParams(location.search).get("v") || "1";
            const hintTexts = {
                zh: `当前：v${currentVer}（地址可加 ?v=1/2/3/4 切换）`,
                en: `Current: v${currentVer} (Add ?v=1/2/3/4 to URL to switch)`
            };
            document.getElementById("hint").textContent = hintTexts[lang];
            
            // Trigger re-render if data is already loaded
            if (window.currentData) {
                window.renderWithLanguage(window.currentData, lang);
            }
        }
        
        // Initialize parameters
        const params = new URLSearchParams(location.search);
        const ver = params.get("v") || "1";
        const lang = params.get("lang") || "zh";
        
        // 不再需要设置select的值，因为已经改为按钮
        // document.getElementById("ver").value = ver;
        
        // Update language on load
        updateLanguage(lang);
        
        // Version change handler - 不再需要，因为已经改为按钮
        // document.getElementById("ver").addEventListener("change", (e) => {
        //     const u = new URL(location.href);
        //     u.searchParams.set("v", e.target.value);
        //     u.searchParams.set("lang", currentLang);
        //     location.href = u.toString();
        // });
        
        // Language change handler
        document.getElementById("lang-toggle").addEventListener("click", () => {
            const newLang = currentLang === 'zh' ? 'en' : 'zh';
            const u = new URL(location.href);
            u.searchParams.set("lang", newLang);
            location.href = u.toString();
        });
        
        // 版本选项卡处理
        const versionTabs = document.querySelectorAll('.version-tab');
        const currentVersion = ver;
        
        // 设置当前版本为激活状态
        versionTabs.forEach(tab => {
            if(tab.dataset.version === currentVersion) {
                tab.classList.add('active');
            }
            
            // 添加点击事件
            tab.addEventListener('click', () => {
                const version = tab.dataset.version;
                const u = new URL(location.href);
                u.searchParams.set("v", version);
                u.searchParams.set("lang", currentLang);
                location.href = u.toString();
            });
        });
        
        // Load version-specific script
        const s = document.createElement("script");
        s.src = `./v${ver}/app.js`;
        s.defer = true;
        document.body.appendChild(s);
    </script>
</body>

</html>